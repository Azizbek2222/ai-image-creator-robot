<!DOCTYPE html><html lang="uz">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta charset="UTF-8">
<title>Reels Smooth Scroll + AdsGram</title>
<style>
  body {
    margin: 0;
    background: #000;
    height: 100vh;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    font-family: Arial, sans-serif;
  }
  .post {
    height: 100vh;
    scroll-snap-align: start;
    position: relative;
  }
  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .title {
    position: absolute;
    bottom: 60px;
    left: 20px;
    color: #fff;
    font-size: 20px;
    text-shadow: 0 0 10px #000;
  }
  .download-btn {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(255,255,255,0.8);
    color: #000;
    padding: 10px 15px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
  }
  .download-btn:hover {
    background: rgba(255,255,255,1);
  }
</style>
</head>
<body><div id="feed"></div><script src="https://sad.adsgram.ai/js/sad.min.js"></script><script>
// -----------------------------
// Videolar ro'yxati
// -----------------------------
let videos = [
  "https://pages111.github.io/video/VID_20251128_120459_430.mp4",
  "https://pages111.github.io/video/VID_20251128_121221_180.mp4",
  "https://pages111.github.io/video/VID_20251128_122137_351.mp4",
  "https://pages111.github.io/video/VID_20251128_122455_934.mp4"
];

// Random tartib
videos.sort(() => Math.random() - 0.5);

const feed = document.getElementById("feed");

// -----------------------------
// HTMLga joylash (Download tugmasi qo‘shildi)
// -----------------------------
videos.forEach((v, i) => {
  feed.innerHTML += `
    <div class="post">
      <video src="${v}" playsinline muted></video>
      <div class="title">Reel ${i + 1}</div>
      <a class="download-btn" href="${v}" download="Reel${i + 1}.mp4">⬇️ Yuklab olish</a>
    </div>
  `;
});

const allVideos = document.querySelectorAll(".post video");
const downloadButtons = document.querySelectorAll(".download-btn");

// -----------------------------
// IntersectionObserver orqali smooth auto-play
// -----------------------------
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      allVideos.forEach(v => v.pause());
      entry.target.play().catch(()=>{});
    }
  });
}, { threshold: 0.7 });

allVideos.forEach(video => observer.observe(video));

// -----------------------------
// Sahifaga kirgan zahoti birinchi video o'ynasin (muted)
window.addEventListener("load", () => {
  if(allVideos.length > 0){
    allVideos[0].play().catch(()=>{});
  }
});

// -----------------------------
// Foydalanuvchi sahifaga birinchi marta tegsa, ovozni yoqish
document.body.addEventListener("click", () => {
  allVideos.forEach(v => v.muted = false);
}, { once: true });

// -----------------------------
// AdsGram blockId
// -----------------------------
const blockId = "int-18350"; // AdsGram blockId
const adCooldown = 150000; // 150 sekund
let lastAdTime = 0;
let watchedVideos = 0;

// -----------------------------
// Funksiya: reklama ko'rsatish (auto-reklama va 20ta video)
function showAd() {
  const now = Date.now();
  if (now - lastAdTime < adCooldown) return; // cooldown
  lastAdTime = now;
  window.Adsgram.init({ blockId }).show().then((result) => {
    console.log("Ad watched:", result);
  }).catch((result) => {
    console.log("Ad error:", result);
  });
}

// -----------------------------
// Download tugmasi: reklamasiz va ishlaydi
downloadButtons.forEach((btn, i) => {
  btn.addEventListener("click", e => {
    e.preventDefault();
    fetch(videos[i])
      .then(resp => resp.blob())
      .then(blob => {
        const link = document.createElement("a");
        link.href = window.URL.createObjectURL(blob);
        link.download = `Reel${i+1}.mp4`;
        link.click();
      });
  });
});

// -----------------------------
// Auto-reklama: 2 sekunddan keyin birinchi marta
setTimeout(() => {
  showAd();
}, 2000);

// -----------------------------
// Auto-reklama: 20 video ko‘rilganda
allVideos.forEach((video) => {
  video.addEventListener("play", () => {
    watchedVideos++;
    if (watchedVideos % 20 === 0) showAd();
  });
});
</script></body>
</html>
